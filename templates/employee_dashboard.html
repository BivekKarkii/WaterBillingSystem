<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
    <style type="text/css">
        .view-bill-btn {
  background-color: #4CAF50; /* Green */
  border: none;
  color: white;
  padding: 8px 16px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 14px;
  margin: 4px 2px;
  cursor: pointer;
}

.create-bill-btn {
  background-color: #f44336; /* Red */
  border: none;
  color: white;
  padding: 8px 16px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 14px;
  margin: 4px 2px;
  cursor: pointer;
}
.navbar img{
    width: 100% !important;
}
.navigation-bar{
    margin-bottom: 15px;
}
.dashmid{
    margin: 0 0 20px 0;
}

.employee_img img{
    width: 100% !important;

}
.login-div{
    display: flex;
    justify-content: flex-end;
}
.employee_img{
    display: flex;
    justify-content: flex-end;
    align-items: center;
}

h1 {
  font-size: 32px;
  text-align: center;
  margin-bottom: 20px;
}

h2 {
  font-size: 24px;
  margin-bottom: 20px;
}

form {
  display: flex;
  flex-direction: column;
}

label {
  font-size: 18px;
  margin-bottom: 10px;
}

input[type="text"],
input[type="number"] {
  font-size: 16px;
  padding: 5px;
  margin-bottom: 20px;
  {#border: none;#}
  {#border-bottom: 2px solid #ccc;#}
  width: 100%;
}

input[type="number"]:focus,
input[type="text"]:focus {
  outline: none;
  border-bottom: 2px solid #1E90FF;
}

button[type="submit"] {
  background-color: #0B59A7;
    color: white;
    font-size: 16px;
    padding: 12px 35px;
    border: none;
    border-radius: 5px;
    margin-top: 20px;
    cursor: pointer;
}

button[type="submit"]:hover {
  background-color: #0066CC;
}

h2, h3 {
	margin-top: 0;
}

.table-container {
	display: flex;
	flex-direction: column;
	align-items: center;
	margin: 30px auto;
}

table {
	border-collapse: collapse;
	width: 100%;
}

th, td {
	padding: 8px;
      border-bottom: 1px solid #ccc;
}

th {
	background-color: #f2f2f2;
    border-top: 2px solid #dee2e6;
}

tbody td:last-child {
	font-weight: bold;
}
tr{
    border-bottom: 1px solid #c6c6c6;
}

button {
	display: block;
    /* padding: 10px 20px; */
    background-color: transparent;
    color: #000000;
    border: navajowhite;
    border-radius: 4px;
    cursor: pointer;
    font-size: 50px;
}

{#button:hover {#}
{#	background-color: #3e8e41;#}
{#}#}

#profileModal .card-body img{
    width: 100% !important;
}

#profileModal body{
    margin-top:20px;
    color: #1a202c;
    text-align: left;
    background-color: #e2e8f0;
}
#profileModal .main-body {
    padding: 15px;
}
#profileModal .card {
    box-shadow: 0 1px 3px 0 rgba(0,0,0,.1), 0 1px 2px 0 rgba(0,0,0,.06);
}

#profileModal .card {
    position: relative;
    display: flex;
    flex-direction: column;
    min-width: 0;
    word-wrap: break-word;
    background-color: #fff;
    background-clip: border-box;
    border: 0 solid rgba(0,0,0,.125);
    border-radius: .25rem;
}

#profileModal .card-body {
    flex: 1 1 auto;
    min-height: 1px;
    padding: 1rem;
}

#profileModal .gutters-sm {
    margin-right: -8px;
    margin-left: -8px;
}

#profileModal .gutters-sm>.col, .gutters-sm>[class*=col-] {
    padding-right: 8px;
    padding-left: 8px;
}
#profileModal .mb-3, .my-3 {
    margin-bottom: 1rem!important;
}

#profileModal .bg-gray-300 {
    background-color: #e2e8f0;
}
#profileModal .h-100 {
    height: 100%!important;
}
#profileModal .shadow-none {
    box-shadow: none!important;
}
#profileModal .modal-dialog{
  max-width: 60% !important;
}
.btn-create{
    background-color: #0B59A7;
    color: #ffffff;
}

.table-hover th, .table-hover td{
    text-align: center;
}
.table-head{
    {#background: #0d6efd;#}
    {#background: #6b7ae0;#}
    {#background-color: #f2f2f2;#}
    color: #212529;
}
.table>:not(:first-child){
    border: none;
}
.table-head th{
    vertical-align: center;
    border-top: 1px solid #dee2e6;
    border-bottom: 2px solid #dee2e6;
    padding: 0.75rem;
}
table tbody td{
    border-top: 2px solid #dee2e6;
    padding: 0.75rem;
}
.update-btn{
    display: flex;
    justify-content: center;
}
#logoutModal .btn-close{
    width: 10px;
    height: 10px;
}
@media print {
    body *{
        visibility: hidden;

    }
    .modal-content,
    .modal-content *
    {
        visibility: visible;
    }
    .modal-content button{
        visibility: hidden;
    }
    .modal-content button span{
        font-size: 0;
    }

     .modal-content {
    position: absolute;
    left: 15%;
    top: 50%;
     margin: auto auto;
     width: 70%;
     {#transform: translate(-50%,-50%);#}
  }
}

    </style>
</head>
<body>
<section class="nav-sec navigation-bar">
      <nav class="navbar navbar-expand-lg navbar-light" style="margin-right: 0 !important;box-shadow: 0px 0px 14px 0px rgba(0,0,0,0.25);background: #ffffff;">
        <div class="container">
          <a class="navbar-brand" href="#"><img src="{% static 'images/logo.png' %}" alt="logo"></a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
             <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent" style="
    display: flex;
    justify-content: flex-end;
">
              <ul class="navbar-nav" style="width: 15%;">
              <div class="login-div employee_img" id="login-toggle">
                  <div style="margin-right: 10px;">
                  <a href="#profileModal" data-bs-toggle="modal" data-bs-target="#profileModal"><img src="{% static 'images/user-circle-solid.svg' %}" alt="bell" > </a>
                </div>
                  <div>
                  <a href="#logoutModal" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#logoutModal">Logout</a>
                    </div>
                </div>
                  <!-- profile Modal -->
 {% for i in emp %}
<div class="modal fade" id="profileModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">User Profile</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="container">
    <div class="main-body">

          <div class="row gutters-sm">
            <div class="col-md-4 mb-3">
              <div class="card">
                <div class="card-body">
                  <div class="d-flex flex-column align-items-center text-center">
                    <img src="https://bootdey.com/img/Content/avatar/avatar7.png" alt="Admin" class="rounded-circle" width="150">
                    <div class="mt-3">
                      <h4>{{i.name}}</h4>

                    </div>
                  </div>
                </div>
              </div>

            </div>
            <div class="col-md-8">
              <div class="card mb-3">
                  <form action="/employee/update/{{i.id}}" method="post">
                      {% csrf_token %}
                <div class="card-body">
                  <div class="row">
                    <div class="col-sm-3">
                      <h6 class="mb-0">Full Name</h6>
                    </div>
                    <div class="col-sm-9 text-secondary">
                        <input type="text" value="{{ i.name }}" id="fullname" name="name" readonly>
                    </div>
                  </div>
                  <hr>
                  <div class="row">
                    <div class="col-sm-3">
                      <h6 class="mb-0">Email</h6>
                    </div>
                    <div class="col-sm-9 text-secondary">
                        <input type="text" value="{{ i.email }}" id="fullname" name="email" required>
                    </div>
                  </div>
                  <hr>
                  <div class="row">
                    <div class="col-sm-3">
                      <h6 class="mb-0">Phone</h6>
                    </div>
                    <div class="col-sm-9 text-secondary">
                        <input type="text" value="{{i.phone}}" id="fullname" name="phone" readonly>

                    </div>
                  </div>
                  <hr>
                  <div class="row">
                    <div class="col-sm-3">
                      <h6 class="mb-0">Citizenship Number</h6>
                    </div>
                    <div class="col-sm-9 text-secondary">
                        <input type="text" value="{{i.citizenship}}" id="fullname" name="citizenship" readonly>

                    </div>
                  </div>
                  <hr>
                  <div class="row">
                    <div class="col-sm-3">
                      <h6 class="mb-0">Address</h6>
                    </div>
                    <div class="col-sm-9 text-secondary">
                        <input type="text" value="{{i.address}}" id="fullname" name="address" required>

                    </div>
                  </div>
                    <input type="text" value="{{i.employee_id}}" id="fullname" name="employee_id" hidden>
                    <input type="text" value="{{i.password}}" id="fullname" name="password" hidden>
                  <hr>
                  <div class="row">
                    <div class="col-sm-12 update-btn">
{#                      <a class="btn btn-info " target="__blank" href="https://www.bootdey.com/snippets/view/profile-edit-data-and-skills">Update</a>#}
                        <button class="btn btn-info " type="submit">Update</button>
                    </div>
                  </div>
                </div>
                  </form>

              </div>



            </div>
          </div>

        </div>
    </div>
      </div>

    </div>
  </div>
</div>
                  {% endfor %}

                <!-- logout Modal -->
                <div class="modal fade" id="logoutModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel"></h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                        Do you want to logout?
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                          <a href="{% url 'employee-page:empsigned_out'%}" class="btn btn-primary">Yes</a>
                      </div>
                    </div>
                  </div>
                </div>
            </ul>
          </div>
        </div>
      </nav>
    </section>

{# ============================================= main page =================================================================== #}
<div class="container">
    <div class="dashmid" style="background: #FFF;border: 1px solid #0d6efd;border-radius: 4px;box-shadow: 0px 5px 20px -17px rgba(0, 0, 0, 0.34);">
    <ul class="flex justify-between">

        <li>Total Consumer :  {{ count }}</li>
        <li>Active : {{ count }}</li>
        <li><div class="crud"></div></li>


    </ul>
</div>

<table class="table table-hover">
  <thead>
    <tr class="table-head">
        <th>Full Name</th>
        <th>Phone Number</th>
        <th>Email</th>
        <th>Address</th>
        <th>Khanepani Type</th>
        <th>Meter No</th>
        <th>Citizenship No</th>
        <th>Consumer Id</th>
        <th>Action</th>
    </tr>
  </thead>
  <tbody>
   {% for i in consumer %}
    <tr>
        <td>{{ i.name }}</td>
        <td>{{ i.phone }}</td>
        <td>{{ i.email }}</td>
        <td>{{ i.address }}</td>
        <td>{{ i.type }}</td>
        <td>{{ i.meter_no }}</td>
        <td>{{ i.citizenship }}</td>
        <td>{{ i.consumer_id }}</td>
        <td>
            <a href="#createbillModal-{{ i.consumer_id }}" class="btn btn-create" data-bs-toggle="modal" data-bs-target="#createbillModal-{{ i.consumer_id }}">Create Bill</a>
            <a href="#viewbillModal-{{ i.consumer_id  }}" class="btn btn-create" data-bs-toggle="modal" data-bs-target="#viewbillModal-{{ i.consumer_id  }}">View Bill</a>
            {#            <button type="button view-bill-btn" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal1">view bill</button>#}
{#            <button class="create-bill-btn">View Bill</button>#}
             </td>
    </tr>
    {% endfor %}
    <tr>

  </tbody>
</table>

 <!-- Modal create bill -->
{% for j in consumer_billing_list %}
    {% for i in j %}
{#{% for j in consumer_billing_list %}#}
{#    {% for i in j %}#}
{#    {% for j in consumer %}#}
<div class="modal fade" id="createbillModal-{{ i.consumer_det.consumer_id }}" tabindex="-1"  aria-labelledby="exampleModalLabel" aria-hidden="true">

  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
{#        <h5 class="modal-title" id="exampleModalLabel">Water Billing System</h5>#}
          <img src="{% static 'images/logo.png' %}" style="width: 50%;">
        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
{#        <div class="container">#}

    <div id="" class="">
      <h2>Create Bill</h2>

      <form action="/billing/meter_readingForm" method="post">
          {% csrf_token %}
{#        <label for="id">ID:</label>#}
{#        <input type="text" id="id" name="id" required>#}

        <label for="invoice_id">Invoice ID:</label>
        <input type="text" id="invoice_id" name="invoice_id" required>

        <label for="consumer_id">Consumer ID:</label>
        <input type="text" value="{{ i.consumer_det.consumer_id }}" id="consumer_id" name="consumer_id" required>

        <label for="consumer_name">Consumer Name:</label>
        <input type="text" value="{{ i.consumer_det.name }}" id="consumer_name" name="consumer_name" required>

        <label for="previousUnit">Previous Unit:</label>
        <input type="number" value="{{ i.current_unit }}" id="previousUnit" name="previous_unit" required>

        <label for="currentUnit">Current Unit:</label>
        <input type="number" id="currentUnit" name="current_unit" required>

        <label for="perUnitPrice">Per Unit Price:</label>
        <input type="text" value="15" id="perUnitPrice" name="perUnitPrice" required>

        <label for="date">Date:</label>
        <input type="date" id="date" name="date" required>

        <label for="meterNo">Meter No:</label>
        <input type="text" value="{{ i.consumer_det.meter_no }}" id="meterNo" name="meter_number" required>

        <label for="totalAmount">Total Amount:</label>
        <input type="text"  id="totalAmount" name="amount" required>

{#          <label for="totalAmount">Total Amount:</label>#}
        <input type="text" value="unpaid"  id="totalAmount" name="status" hidden="">

          <input type="number" value="{{ i.consumer_det.id }}"  id="id" name="id">

        <button type="submit">Submit</button>
      </form>
    </div>
{#  </div>#}
      </div>
{#      <div class="modal-footer">#}
{#        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>#}
{#        <button type="button" class="btn btn-primary">Save changes</button>#}
{#      </div>#}
    </div>
  </div>
</div>
{% endfor %}
{% endfor %}


<!-- Modal view bill -->
{% for j in consumer_billing_list %}
    {% for i in j %}
<div class="modal fade" id="viewbillModal-{{ i.consumer_det.consumer_id }}" tabindex="-1"  aria-labelledby="exampleModalLabel" aria-hidden="true">

  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
{#        <h5 class="modal-title" id="exampleModalLabel">Water Billing System</h5>#}
          <img src="{% static 'images/logo.png' %}" style="width: 50%;">
        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body printbill-modal">
{#<h1>Water Billing System</h1>#}
{#		<h2>BlueLine Splash</h2>#}
		<h3 style="text-align: center">Bill Invoice</h3>
		<div class="table-container">
			<table>
				<tr>
					<th>Consumer ID</th>
					<td>{{ i.consumer_det.consumer_id }}</td>
				</tr>
				<tr>
					<th>Name</th>
					<td>{{ i.consumer_det.name }}</td>
				</tr>
				<tr>
					<th>Address</th>
					<td>{{ i.consumer_det.address }}</td>
				</tr>
				<tr>
					<th>Previous Unit</th>
					<td>{{ i.previous_unit }}</td>
				</tr>
				<tr>
					<th>Current Unit</th>
					<td>{{ i.current_unit }}</td>
				</tr>
				<tr>
					<th>Total Amount</th>
					<td><strong>{{ i.amount }}</strong></td>
				</tr>
			</table>
		</div>
{#		<button onclick="window.print()">Print Bill</button>#}
          <button type="submit" onclick="window.print()">Print Bill</button>
	</div>
      </div>
    </div>
  </div>
</div>
{% endfor %}
{% endfor %}





</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>


<script>
    $(document).ready(function(){
	// Activate tooltip
	$('[data-toggle="tooltip"]').tooltip();

	// Select/Deselect checkboxes
	var checkbox = $('table tbody input[type="checkbox"]');
	$("#selectAll").click(function(){
		if(this.checked){
			checkbox.each(function(){
				this.checked = true;
			});
		} else{
			checkbox.each(function(){
				this.checked = false;
			});
		}
	});
	checkbox.click(function(){
		if(!this.checked){
			$("#selectAll").prop("checked", false);
		}
	});
});
</script>
<script>
    // Get the input elements
    var previousUnitInput = document.getElementById('previousUnit');
    var currentUnitInput = document.getElementById('currentUnit');
    var perUnitPriceInput = document.getElementById('perUnitPrice');
    var totalAmountInput = document.getElementById('totalAmount');

    // Add event listener to current unit input
    currentUnitInput.addEventListener('input', calculateTotalAmount);

    // Function to calculate the total amount
    function calculateTotalAmount() {
      // Get the values from the input fields
      var previousUnit = parseFloat(previousUnitInput.value);
      var currentUnit = parseFloat(currentUnitInput.value);
      var perUnitPrice = parseFloat(perUnitPriceInput.value);

      // Calculate the consumption
      var consumption = currentUnit - previousUnit;

      // Calculate the total amount
      var totalAmount = consumption * perUnitPrice;

      // Update the total amount input field with the calculated value
      totalAmountInput.value = totalAmount.toFixed(2); // Adjust the number of decimal places as needed
    }

    // Call the calculateTotalAmount function initially to set the initial value
    calculateTotalAmount();
</script>
</body>
</html>